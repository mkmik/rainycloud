<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>Config.scala</title>
  <link rel="stylesheet" href="../.docco/main.css"/>
  <script type="text/javascript" src="../.docco/highlight.js">
  </script>
  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>
</head>
<body>
<div id="container">
  <div id="background"></div>
  <table cellspacing="0" cellpadding="0">
    <thead>
    <tr>
      <th class="docs">
        <h1><a href="../index.html" title="Back to index">&larr;</a>&nbsp;&nbsp;Config.scala</h1>
      </th>
      <th class="code"></th>
    </tr>
    </thead>
    <tbody>
    <tr id="section-0">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorpe" href="#section-0">#</a>
        </div>
      <p></p>
      </td>
      <td class="code">
        <pre><code>package it.cnr.aquamaps</code></pre>
      </td>
    </tr>
    <tr id="section-1">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
      <p>!
This is the Guice component wiring for a particular implementation scenario</p>
      </td>
      <td class="code">
        <pre><code>import com.google.inject._
import com.google.inject.name._
import uk.me.lings.scalaguice.ScalaModule
import net.lag.configgy.Config
import io.Source.fromFile

case class AquamapsModule() extends AbstractModule with ScalaModule with RainyCloudModule {
  def configure() {
    bind[Config].toInstance(conf)</code></pre>
      </td>
    </tr>
    <tr id="section-2">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
      <p>!## Basic components</p>

<p>   We select partitioner which loads the pre-made partitions from a plain text file, an implementation of the <code>Generator</code> and
   <code>HspecAlgorithm</code> components.</p>
      </td>
      <td class="code">
        <pre><code>    bind[Partitioner].toInstance(new StaticPartitioner(ranges))
    bind[Generator].to[HSPECGenerator]
    bind[HspecAlgorithm].to[RandomHSpecAlgorithm]</code></pre>
      </td>
    </tr>
    <tr id="section-3">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
      <p>!## HSPEN database</p>

<p>   HSPEN data is loaded from a gzipped csv file located in the filesystem. Each worker should load this file once.</p>
      </td>
      <td class="code">
        <pre><code>    bind[Loader[HSPEN]].to[TableHSPENLoader]
    bind[TableReader[HSPEN]].toInstance(new FileSystemTableReader(conf.getString(&quot;hspenFile&quot;).getOrElse(&quot;data/hspen.csv.gz&quot;)))
    bind[PositionalSource[HSPEN]].to[CSVPositionalSource[HSPEN]]</code></pre>
      </td>
    </tr>
    <tr id="section-4">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorpe" href="#section-4">#</a>
        </div>
      <p>!## HCAF database</p>

<pre><code>In this wiring the &#96;HCAF&#96; database is loaded in memory from a gzipped csv file too, and the local worker
will fetch a given partition as a slice of the whole &#96;HCAF&#96; db held in RAM. This is inefficient but works well
for our first prototype.</code></pre>
      </td>
      <td class="code">
        <pre><code>    bind[Loader[HCAF]].to[TableHCAFLoader].in[Singleton]
    bind[TableReader[HCAF]].toInstance(new FileSystemTableReader(conf.getString(&quot;hcafFile&quot;).getOrElse(&quot;data/hcaf.csv.gz&quot;)))
    bind[PositionalSource[HCAF]].to[CSVPositionalSource[HCAF]].in[Singleton]
    bind[Fetcher[HCAF]].to[MemoryFetcher[HCAF]].in[Singleton]</code></pre>
      </td>
    </tr>
    <tr id="section-5">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorpe" href="#section-5">#</a>
        </div>
      <p>!## Emitter</p>

<pre><code>The purpose of the emitter is to collect generated &#96;HSPEC&#96; records and write them somewhere. This emitter will write a CSV file.
The file can be compressed (performance penalilty).</code></pre>
      </td>
      <td class="code">
        <pre><code>    bind[TableWriter[HSPEC]].toInstance(new FileSystemTableWriter(conf.getString(&quot;hspecFile&quot;).getOrElse(&quot;/tmp/hspec.csv.gz&quot;)))
    bind[PositionalSink[HSPEC]].to[CSVPositionalSink[HSPEC]].in[Singleton]
    bind[Emitter[HSPEC]].to[CSVEmitter[HSPEC]].in[Singleton]</code></pre>
      </td>
    </tr>
    <tr id="section-6">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorpe" href="#section-6">#</a>
        </div>
      <p>!## Octobot</p>

<pre><code>(ignore this)
This is the octobot entry point, which is loaded from a different entry point (in fact we could move this to separate guice module)</code></pre>
      </td>
      <td class="code">
        <pre><code>    bind[Bot].to[HSPECGeneratorOctobot]
  }

  def ranges: Iterator[String] = {
    val ranges = conf.getList(&quot;inlineranges&quot;)
    if(ranges.isEmpty)
      fromFile(conf.getString(&quot;ranges&quot;).getOrElse(&quot;octo/client/ranges&quot;)).getLines
    else
      ranges.toIterator
  }
}</code></pre>
      </td>
    </tr>
  </table>
</div>
</body>
</html>